# PostgreSQL Configuration for Point-in-Time Recovery (PITR)
# This configuration enables continuous archiving and WAL archiving

#------------------------------------------------------------------------------
# WRITE AHEAD LOG
#------------------------------------------------------------------------------

# - Settings -

#wal_level = replica                    # minimal, replica, or logical
wal_level = replica

#------------------------------------------------------------------------------
# CONNECTIONS AND AUTHENTICATION
#------------------------------------------------------------------------------

# Listen on all network interfaces so other containers can connect
listen_addresses = '*'

#fsync = on                            # flush data to disk for crash safety
fsync = on

#synchronous_commit = on               # synchronization level;
synchronous_commit = on

#wal_sync_method = fsync              # the default is the first option
wal_sync_method = fsync

#full_page_writes = on                 # recover from partial page writes
full_page_writes = on

#wal_compression = off                 # enable compression of full-page writes
wal_compression = off

#wal_log_hints = off                   # also log changes for pages with hints
wal_log_hints = off

#wal_buffers = -1                      # min 32kB, -1 sets based on shared_buffers
wal_buffers = 16MB

#wal_writer_delay = 200ms              # 1-10000 milliseconds
wal_writer_delay = 200ms

#commit_delay = 0                      # range 0-100000, in microseconds
commit_delay = 0

#commit_siblings = 5                   # range 1-1000
commit_siblings = 5

# - Checkpoints -

#checkpoint_timeout = 5min             # range 30s-1d
checkpoint_timeout = 5min

#max_wal_size = 1GB
max_wal_size = 1GB

#min_wal_size = 80MB
min_wal_size = 80MB

#checkpoint_completion_target = 0.5   # checkpoint target duration, 0.0-1.0
checkpoint_completion_target = 0.9

#checkpoint_flush_after = 256kB       # measured in pages, 0 disables
checkpoint_flush_after = 256kB

#checkpoint_warning = 30s              # 0 disables
checkpoint_warning = 30s

# - Archiving -

#archive_mode = off                    # enables archiving; off, on, or always
archive_mode = on

#archive_command = ''                  # command to use to archive a logfile segment
# wal-g automatically compresses and uploads WAL files to S3
# Exit code 0 = success, non-zero = failure (PostgreSQL will retry on failure)
# %p = full path to WAL file, %f = WAL file name
archive_command = '/usr/local/bin/wal-g-archive.sh %p %f'

#archive_timeout = 0                   # force a logfile segment switch after this
archive_timeout = 300

# - Recovery -

#recovery_target_timeline = 'latest'   # 'current', 'latest', or timeline ID
#recovery_target_timeline = 'latest'

#recovery_target_action = 'pause'      # 'pause', 'promote', 'shutdown'
#recovery_target_action = 'pause'

# - Archive Recovery -

#restore_command = ''                  # command to use to restore an archived logfile segment
# wal-g automatically downloads and decompresses WAL files from S3
restore_command = '/usr/local/bin/wal-g-restore.sh %f %p'

#archive_cleanup_command = ''          # command to execute at every restartpoint
#archive_cleanup_command = ''

# - Replication -

#max_wal_senders = 10                  # max number of walsender processes
max_wal_senders = 10

#max_replication_slots = 10            # max number of replication slots
max_replication_slots = 10

#track_commit_timestamp = off          # collect timestamp of transaction commit
track_commit_timestamp = off

# - Standby Servers -

#hot_standby = on                      # "on" allows queries during recovery
hot_standby = on

#max_standby_archive_delay = 30s       # max delay before canceling queries
max_standby_archive_delay = 30s

#max_standby_streaming_delay = 30s     # max delay before canceling queries
max_standby_streaming_delay = 30s

#wal_receiver_status_interval = 10s    # send replies at least this often
wal_receiver_status_interval = 10s

#hot_standby_feedback = off            # send info from standby to prevent
hot_standby_feedback = off

#wal_receiver_timeout = 60s            # time that receiver waits for
wal_receiver_timeout = 60s

#wal_retrieve_retry_interval = 5s      # time to wait before retrying to
wal_retrieve_retry_interval = 5s

# - Query Tuning -

#random_page_cost = 4.0                # measured on an arbitrary scale
random_page_cost = 4.0

#effective_io_concurrency = 1          # 1-1000; 0 disables prefetching
effective_io_concurrency = 1

# - Error Reporting and Logging -

#log_destination = 'stderr'            # Valid values are combinations of
log_destination = 'stderr'

#logging_collector = off               # Enable capturing of stderr and csvlog
logging_collector = on

#log_directory = 'log'                 # directory where log files are written
log_directory = 'log'

#log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'  # log file name pattern
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'

#log_truncate_on_rotation = off        # If on, an existing log file with the
log_truncate_on_rotation = off

#log_rotation_age = 1d                 # Automatic rotation of logfiles will
log_rotation_age = 1d

#log_rotation_size = 10MB              # Automatic rotation of logfiles will
log_rotation_size = 10MB

#log_min_duration_statement = -1       # -1 is disabled, 0 logs all statements
log_min_duration_statement = 1000

#log_line_prefix = ''                  # special values:
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '

#log_checkpoints = off
log_checkpoints = on

#log_connections = off
log_connections = on

#log_disconnections = off
log_disconnections = on

#log_lock_waits = off                  # log lock waits >= deadlock_timeout
log_lock_waits = on

#log_temp_files = -1                   # log temporary files equal or larger
log_temp_files = 0

#log_autovacuum_min_duration = -1      # -1 disables, 0 logs all actions
log_autovacuum_min_duration = 0

#log_error_verbosity = default         # terse, default, or verbose messages
log_error_verbosity = verbose

#log_hostname = off
log_hostname = on

#log_statement = 'none'                # none, ddl, mod, all
log_statement = 'all'

#log_replication_commands = off
log_replication_commands = on

#log_timezone = '(defaults to server environment setting)'
log_timezone = 'UTC'

# - Process Title -

#cluster_name = ''                     # added to process titles if nonempty
cluster_name = 'foodplatform'

# - Statistics -

#track_activities = on
track_activities = on

#track_counts = on
track_counts = on

#track_io_timing = off
track_io_timing = on

#track_functions = none                # none, pl, all
track_functions = all

#stats_temp_directory = 'pg_stat_tmp'  # where to store temporary statistics (removed in PostgreSQL 15)


# - Autovacuum -

#autovacuum = on                       # Enable autovacuum subprocess?  'on'
autovacuum = on

#autovacuum_max_workers = 3            # max number of autovacuum subprocesses
autovacuum_max_workers = 3

#autovacuum_naptime = 1min             # time between autovacuum runs
autovacuum_naptime = 1min

#autovacuum_vacuum_threshold = 50      # min number of row updates before
autovacuum_vacuum_threshold = 50

#autovacuum_analyze_threshold = 50     # min number of row inserts before
autovacuum_analyze_threshold = 50

#autovacuum_vacuum_scale_factor = 0.2  # fraction of table size before vacuum
autovacuum_vacuum_scale_factor = 0.2

#autovacuum_analyze_scale_factor = 0.1 # fraction of table size before analyze
autovacuum_analyze_scale_factor = 0.1

#autovacuum_freeze_max_age = 200000000 # maximum XID age before forced vacuum
autovacuum_freeze_max_age = 200000000

#autovacuum_multixact_freeze_max_age = 400000000        # maximum multixact ID
autovacuum_multixact_freeze_max_age = 400000000

#autovacuum_vacuum_cost_delay = 2ms    # default vacuum cost delay for
autovacuum_vacuum_cost_delay = 2ms

#autovacuum_vacuum_cost_limit = -1     # default vacuum cost limit for
autovacuum_vacuum_cost_limit = -1

# - Client Connection Defaults -

#default_transaction_isolation = 'read committed'
default_transaction_isolation = 'read committed'

#default_transaction_read_only = off
default_transaction_read_only = off

#default_transaction_deferrable = off
default_transaction_deferrable = off

#session_replication_role = 'origin'
session_replication_role = 'origin'

#statement_timeout = 0                 # 0 is disabled
statement_timeout = 0

#lock_timeout = 0                      # 0 is disabled
lock_timeout = 0

#idle_in_transaction_session_timeout = 0        # 0 is disabled
idle_in_transaction_session_timeout = 0

#vacuum_freeze_min_age = 50000000
vacuum_freeze_min_age = 50000000

#vacuum_freeze_table_age = 150000000
vacuum_freeze_table_age = 150000000

#vacuum_multixact_freeze_min_age = 5000000
vacuum_multixact_freeze_min_age = 5000000

#vacuum_multixact_freeze_table_age = 150000000
vacuum_multixact_freeze_table_age = 150000000

#bytea_output = 'hex'                  # hex, escape
bytea_output = 'hex'

#xmlbinary = 'base64'                  # xmlbinary = 'base64'
xmlbinary = 'base64'

#xmloption = 'content'                 # xmloption = 'content'
xmloption = 'content'

#gin_fuzzy_search_limit = 0
gin_fuzzy_search_limit = 0

#gin_pending_list_limit = 4MB
gin_pending_list_limit = 4MB

# - Lock Management -

#deadlock_timeout = 1s
deadlock_timeout = 1s

#max_locks_per_transaction = 64        # min 10
max_locks_per_transaction = 64

#max_pred_locks_per_transaction = 64   # min 10
max_pred_locks_per_transaction = 64

#max_pred_locks_per_relation = -2      # negative means no limit
max_pred_locks_per_relation = -2

#max_pred_locks_per_page = 2           # negative means no limit
max_pred_locks_per_page = 2

# - Version and Platform Compatibility -

#array_nulls = on
array_nulls = on

#backslash_quote = safe_encoding        # on, off, or safe_encoding
backslash_quote = safe_encoding

#default_with_oids = off
default_with_oids = off

#escape_string_warning = on
escape_string_warning = on

#lo_compat_privileges = off
lo_compat_privileges = off

#quote_all_identifiers = off
quote_all_identifiers = off

#standard_conforming_strings = on
standard_conforming_strings = on

#synchronize_seqscans = on
synchronize_seqscans = on

# - Other Defaults -

#dynamic_library_path = '$libdir'
dynamic_library_path = '$libdir'

#local_preload_libraries = ''
local_preload_libraries = ''

#session_preload_libraries = ''
session_preload_libraries = ''

#jit = on                              # allow JIT compilation
jit = on

# - Error Handling -

#exit_on_error = off                   # terminate session on any error?
exit_on_error = off

#restart_after_crash = on              # reinitialize after backend crash?
restart_after_crash = on

# - Config File Includes -

# These options allow settings to be loaded from files other than the
# default postgresql.conf.

#include_dir = 'conf.d'                # include files ending in '.conf' from
#include_dir = 'conf.d'

#include_if_exists = 'exists.conf'     # include file only if it exists
#include_if_exists = 'exists.conf'

#include = 'special.conf'              # include file
#include = 'special.conf'

# - Customized Options -

# Add any custom settings here
